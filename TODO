# To acquire parity with the GTK version and be good enough to share:

On new season, don't update ratings for retired players
- in player view for retired players, either don't show ratings, or show ratings from best year

create constants for numbers (phases, freeagent/retired/whatever)

BUG: "contract negotiation in progress" status appears in offseason

BUG: no roster size limit seems to be applied against AI teams

database crap
- optimize
  - why is it so slow, and so disk thrashy?
  - are my keys correct/optimal/uptodate? unique keys?
- redo schema
  - separate dbs for leagues
    - grep -R --include="*.py" '%s_' .
    - what user permissions do i need, exactly? update README
  - new column names
  - normalize (especially the drafted table)
    - move roster_position to player_attributes
  - get rid of INSERTS in .sql file, instead have data elsewhere
  - get rid of weird tables, replace with a key-value store table
  - bbgm.core.league.delete

player view
- next, previous buttons (also active on left/right arrows)
- "trade for" button
- http://twitter.github.com/bootstrap/javascript.html#tabs
  - tab for player ratings
  - tab for playoff stats
  - tab for game log
- link to team roster

get rid of subprocess in __init__.py, somehow?

roster
- "release" only sensitive with more than 5 players
- "buy out" only sensitive when there's enough money
- highlight handle on hover, like button
- "Trade for" button in other teams' view

trades

datatables
- default to sort descending when column is clicked
  - http://datatables.net/ref#asSorting will work. maybe pass it as an option to bbgm_datatable

finances
- conditional formatting to show negative numbers in red: https://www.google.com/search?q=site%3Adatatables.net+conditional+formatting&ie=utf-8&oe=utf-8&client=ubuntu&channel=fs

BUG:
- players ask for negative years contracts when resigning them
  - i think this is fixed..

Client-side game simulation
- 2: implement client-side
    - If no response after timeout expires, delete timeout, then unset lock and update play menu
- 2.5: fix javascript
  - http://bonsaiden.github.com/JavaScript-Garden/
    - Namespaces "/A common problem of having only one global namespace" "In order to protect code against a possible overwritten undefined variable, a common technique used is to add an additional parameter to an anonymous wrapper that gets no argument passed to it."
      - just copy what jquery does
    - "For the best performance, it is recommended to always use the plain for loop and cache the length property. The use of for in on an array is a sign of badly written code that is prone to bugs and bad performance."
    - It is highly recommended to only use the strict equality (===) operator.
- 4: web workers? https://developer.mozilla.org/En/Using_web_workers
  - can spawn multiple workers in parallel. "transferable objects" would speed it up
- Robustness of javascript code
  - g.phase == 3 in league_views might introduce race condition
  - validate data from client?
  - make sure play menu doesn't ever get stuck

configuration in text file?
- http://flask.pocoo.org/docs/patterns/fabric/#the-configuration-file
- http://flask.pocoo.org/snippets/2/

contract negotiation view
- bring back to either free agent view or resigning view after either accept or cancel

dashboard: a bunch of boxes showing..
- record
- playoff scenario
- history
- roster spots
- payroll
- expiring contracts
- top free agents
- league leaders
- team leaders

fix commented lines in bbgm.core.season

refactor player.py

speed it up
- somehow cache team (and/or player) dicts, so we don't need separate SQL queries all the time

play menu
- just send everything over one juggernaut connection per league?

Single page application
- When a simulation is done (or a player is signed, or whatever), the current page should be reloaded
- during page reloads or back/forward... what about handling deeper content in URLs? i.e., what box score is being viewed? what year? what stat is sorted? what page in rankings? etc.
- when a form uses redirect_or_json, the URL isn't updated. not sure what the best way to fix that is.

move to new window button, like gmail, that will open a view in a new window with a minimal UI

game log
- pushstate for individual box scores as well as teams and seasons, somehow?

play button requirements
- colors - is this a good idea?
  - green: move to new phase
  - blue: play games
  - red: other immediate action

make validate_season work correctly

include sidebar(s) showing all relevant information, plus make that stuff generated by a separate function so it can eventually be kept static as JS updates other content

grep for # links

how to start/manage all these services?
- supervisor
  - https://github.com/ask/celery/tree/master/contrib/supervisord/

security
- password hashing
  - http://packages.python.org/passlib/new_app_quickstart.html
- csrf protection
  - http://flask.pocoo.org/docs/security/#cross-site-request-forgery-csrf
  - http://packages.python.org/Flask-SeaSurf/
  - http://flask.pocoo.org/snippets/3/
  - even for ajax https://docs.djangoproject.com/en/1.2/releases/1.2.5/#csrf-exception-for-ajax-requests
- http://pypi.python.org/pypi/Flask-KVSession
- http://packages.python.org/Flask-Login/
- http://flask.pocoo.org/snippets/70/

roster_position
- what happened in pygobject version?
  - set automatically when season starts, or when league is created?
  - set after trade (auto) or signing (stick at bottom)

pep8
- https://github.com/hhatto/autopep8

logging
- should be more ubiquitous
- doesn't get saved to file inside celery task, but they do show up on the celeryd screen

next redirect like http://flask.pocoo.org/docs/reqcontext/?highlight=url#diving-into-context-locals
- http://flask.pocoo.org/snippets/62/

unit tests like https://github.com/mitsuhiko/flask/blob/master/examples/minitwit/minitwit_tests.py

playoffs
- on playoffs start, automatically switch to playoffs view
- before playoffs, show current playoff seedings

http://flask.pocoo.org/snippets/11/

# Then

self-contained game simulation code, to allow other people to hack on it easily. automatically make charts and stuff.

postgresql
- https://help.ubuntu.com/community/PostgreSQL
- python-psycopg2

warning when window is closed and game simulation is in progress
- http://stackoverflow.com/questions/1244535/alert-when-browser-window-closed-accidentally
- https://developer.mozilla.org/en/DOM/window.onbeforeunload

abstract opposing team AI: make it a class with various methods to determine actions at different time points

add years dropdown to all relevant views
- player ratings, eventually
- playoffs, eventually

# BELOW IS OLD STUFF

Minor bugs:

Lottery should be for the 14 teams not in the playoffs, which isn't necessarily the same as the 14 worst teams.
Don't allow sort from first column of trade window

---

On release
- Update all version numbers (setup.py, README, about dialog box, save file, tables.sql (game_attributes), debian/changelog)
- Turn off debug mode

---
speed
- do simulations in C?

- unit tests
  - schedule

Separate files
- Each window/dialog gets its own glade file and own .py file in views folder
- initial build in each constructor DELETE THIS CRAP

Prettier UI: embed Webkit
- http://www.aclevername.com/articles/python-webgui/

when negotiating, players change values too much when you try to change years

pyflakes

======
FUTURE
======

GAMESIM
-------
overtime
take all ratings into account
blocks, assists (maybe other things) should not be so evenly distributed
home and away games
synergy
- Gameplay bonuses when any of the following are true...
  - At least one player with dribbling > X
  - At least two players with shooting_three_pointers > X
  - At least three players with shooting_three_pointers > X
  - At least four players with shooting_three_pointers > X
  - At least one player with rebounding > X
  - At least one player with blocks > X
  - At least three players with steals > X
  - At least one player with inside_scoring > X
  - At least three players with speed > X and (shooting_layups > X or shooting_layups + jumping > X)

UI
--
view any team in the roster window
    drop down box at the top with team names
    all actions disabled unless team_id == common.PLAYER_TEAM_ID
    open this window when a team is double-clicked on in the standings
customize which columns are displayed in treeviews - kiwi
treeview formatting
    str, int, float, currency, date, age - do formatting based on column type
progress bars
filtering should be done with treemodelfilter? - see pygtk tutorial
play menu
    even after hiding, accelerators still work, so on menuitem activation, check to make sure it's a valid choice!!!
        or: set accelerators in python code, not glade.  then i can reuse accelerators
ratings log tab on player window
some indication of synergy
toolbar to supplement the menubar
- New Open Save | Play (drop down menu) | Roster TeamHistory | Trade FreeAgents
league history
should trade window be a window or dialog?
update statusbar while game is saving/loading
player info window spawned from trade dialog and contract window should have clickable controls
- problem: a minimal example doesn't have this problem, so I don't know what's wrong
in team stats tab, allow toggle to show opponent stats

NBA
---
real salary cap rules: http://en.wikipedia.org/wiki/NBA_Salary_Cap
    released players should count against cap
real contract rules (max/min, etc.)
allow contracts that aren't the same $ every year
team and player options
releasing players - see the salary cap wiki page for complicated rule
luxury tax: (team_salary - 65mil) penalty if team salary is > 65mil
trading deadline

BACKEND
-------
archive stats as averages - this will make the end of season awards feasible, and make the stats view faster/easier
uncertainty in rating - for each player, calculate a randn(0, 3) with max/min of +/- 5
    calculate a new one each year and add it to 1/2 of the previous one
teams should be smart in resigning players (now it's just random)
use constants for phase #'s, other things.  maybe create a dict CONST in common.py?
    confirm that teams always have at least 5 players

AI (NON-GAMESIM)
----------------
trade
- mechanism similar to free_agent_times_asked to prevent prolonged negotiations
- AI teams trade with each other
- opponent GM trade AI based on their team's status: contending or rebuilding
- record player value for contending and rebuilding teams in player_attributes, so opposing GMs can more easily suggest trades (i.e. "i'll make the deal if you throw in X")
- Feedback from trades (way off, that's close, etc)
- "Oh, you again?" after failed trade attempts
- AI teams should be aware of contract lengths and the implications thereof
AI teams release/buy out players to sign a better free agent

FEATURES
--------
injuries
opponent GM trade AI based on their team's status: contending or rebuilding
change prices of tickets, concessions, etc
hire coaches to influence development
different sized cities with differently passionate fanbases - affects attendance and home court advantage
multi-team trades... how can i make a good UI for that?
advanced stats (+/-, PER, etc)
punishment for going in debt: if cash is less than $10M, can't sign any new contracts
advisors
trades
- draft picks
- cash
- drop players as part of trade, to free up roster space
